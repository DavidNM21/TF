<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Formulario de pedidos rápido y fácil de usar para gestionar productos y cantidades.">
    <title>Formulario de Pedidos</title>
    <style>
        body {
            background-color: #FFDE59;
            color: #39383B;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0 20px;
        }

        .order-form {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .form-header {
            margin-bottom: 20px;
        }

        h2 {
            color: #39383B;
            margin-bottom: 10px;
            margin-top: 10px;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        label {
            display: block;
            text-align: left;
            font-weight: bold;
            margin-top: 10px;
        }

        select,
        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #39383B;
            border-radius: 4px;
            background-color: #fff;
            color: #39383B;
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%2339383B" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
        }

        input:focus,
        select:focus {
            border-color: #FFB700;
            outline: none;
            box-shadow: 0 0 5px rgba(255, 183, 0, 0.7);
        }

        .product-quantity {
            width: 75px;
            display: inline-block;
            margin-left: 10px;
        }

        button {
            background-color: #39383B;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.2s ease;
            margin-top: 15px;
            margin-right: 10px;
        }

        button:hover {
            opacity: 0.8;
            transform: scale(1.03);
        }

        #resetButton {
            background-color: #F60000;
        }

        #sendToWhatsApp {
            background-color: #25CC64;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            width: 40px;
            height: 20px;
            background-color: #ccc;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
        }

        .toggle-switch::before {
            content: "";
            width: 18px;
            height: 18px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 1px;
            left: 1px;
            transition: left 0.3s ease;
        }

        .toggle-switch.active {
            background-color: #25CC64;
        }

        .toggle-switch.active::before {
            left: 21px;
        }

        .search-container {
            display: none;
        }

        .search-container.active {
            display: block;
        }

        .dropdown-container.active {
            display: block;
        }

        .dropdown-container {
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #39383B;
            border-radius: 4px;
            resize: vertical;
            min-height: 50px;
        }
    </style>
</head>

<body>
    <div class="order-form">
        <div class="form-header">
            <h3>Datos del Pedido</h3>
            <div class="form-group">
                <label for="horario">Horario para recibir pedido (obligatorio):</label>
                <select id="horario" required>
                    <option value="">Seleccione una opción</option>
                    <option value="1er-hora">1er hora (9:00 am a 11:00 am)</option>
                    <option value="am">AM (11:30 am a 3:00pm)</option>
                    <option value="pm">PM (4:30pm a 6:30pm)</option>
                    <option value="programado">Programado (otro día)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="forma-pago">Forma de pago (obligatorio):</label>
                <select id="forma-pago" required>
                    <option value="">Seleccione una opción</option>
                    <option value="efectivo">Efectivo</option>
                    <option value="transferencia">Transferencia</option>
                    <option value="tarjeta">Tarjeta</option>
                </select>
            </div>

            <div class="form-group">
                <label for="nombre-cliente">Cliente (Nombre y Apellido o Nombre de Empresa):</label>
                <input type="text" id="nombre-cliente" placeholder="Nombre del Cliente" required>
            </div>

            <div class="form-group">
                <label for="calle">Calle:</label>
                <input type="text" id="calle" placeholder="Calle" required>
            </div>

            <div class="form-group">
                <label for="numero">Número de casa o taller:</label>
                <input type="text" id="numero" placeholder="Número" required>
            </div>

            <div class="form-group">
                <label for="colonia">Colonia:</label>
                <input type="text" id="colonia" placeholder="Colonia" required>
            </div>

            <div class="form-group">
                <label for="ciudad">Ciudad:</label>
                <input type="text" id="ciudad" placeholder="Ciudad" required>
            </div>

            <div class="form-group">
                <label for="referencias">Referencias o comentarios (opcional):</label>
                <textarea id="referencias" placeholder="Escriba alguna referencia o comentario"></textarea>
            </div>
        </div>

        <div id="productCount">Productos seleccionados: 0</div>
        <div id="productContainer">
            <!-- Aquí se generarán las filas de productos -->
        </div>
        <div class="actions">
            <button id="addProduct" onclick="addProductRow()">Agregar Producto (+)</button>
            <button id="copyAll" onclick="copyAllToClipboard()">Copiar Todo</button>
            <button id="sendToWhatsApp" onclick="sendToWhatsApp()">Enviar a WhatsApp</button>
            <button id="resetButton">Borrar todo</button>
        </div>
    </div>

    <script>
        const data = {
            "a": {
                "a1": [{ name: "Producto A1-1", id: "IDNAME:C100C18" }, { name: "Producto A1-2", id: "IDNAME:C100C19" }],
                "a2": [{ name: "Producto A2-1", id: "IDNAME:C100C21" }, { name: "Producto A2-2", id: "IDNAME:C100C22" }]
            },
            "b": {
                "b1": [{ name: "Producto B1-1", id: "IDNAME:C100C27" }, { name: "Producto B1-2", id: "IDNAME:C100C28" }],
                "b2": [{ name: "Producto B2-1", id: "IDNAME:C100C30" }, { name: "Producto B2-2", id: "IDNAME:C100C31" }]
            }
        };

        let productCounter = 0;
        const maxProducts = 30;

        function updateProductCount() {
            document.getElementById('productCount').textContent = `Productos seleccionados: ${productCounter}`;
        }

        function createProductRow(index) {
            const productRow = document.createElement('div');
            productRow.className = 'product-row';
            productRow.innerHTML = `
                <h2>Producto ${index + 1}
                    <div class="switch-container">
                        <span>Búsqueda directa</span>
                        <div class="toggle-switch" onclick="toggleSearchMode(${index})"></div>
                    </div>
                </h2>
                <div class="dropdown-container active">
                    <label for="category${index}">Categoría:</label>
                    <select id="category${index}" onchange="handleCategoryChange(${index})">
                        <option value="">Selecciona una categoría</option>
                        <option value="a">Categoría A</option>
                        <option value="b">Categoría B</option>
                    </select>

                    <label for="subcategory${index}">Subcategoría:</label>
                    <select id="subcategory${index}" disabled onchange="handleSubcategoryChange(${index})">
                        <option value="">Selecciona una subcategoría</option>
                    </select>

                    <label for="product${index}">Producto:</label>
                    <select id="product${index}" disabled onchange="handleProductChange(${index})">
                        <option value="">Selecciona un producto</option>
                    </select>
                </div>
                <div class="search-container">
                    <label for="search${index}">Buscar Producto o ID:</label>
                    <input type="text" id="search${index}" placeholder="Escribe el nombre o ID" oninput="searchProduct(${index})">
                    <div id="searchResults${index}"></div>
                </div>
                <input type="number" id="quantity${index}" class="product-quantity" min="1" placeholder="Piezas" disabled>
            `;
            return productRow;
        }

        function addProductRow() {
            if (productCounter < maxProducts) {
                const productContainer = document.getElementById('productContainer');
                productContainer.appendChild(createProductRow(productCounter));
                productCounter++;
                updateProductCount();
            } else {
                alert('Has alcanzado el máximo de 30 productos.');
            }
        }

        function toggleSearchMode(index) {
            const toggleSwitch = document.querySelector(`#productContainer .product-row:nth-child(${index + 1}) .toggle-switch`);
            const dropdownContainer = document.querySelector(`#productContainer .product-row:nth-child(${index + 1}) .dropdown-container`);
            const searchContainer = document.querySelector(`#productContainer .product-row:nth-child(${index + 1}) .search-container`);

            toggleSwitch.classList.toggle('active');
            const isActive = toggleSwitch.classList.contains('active');

            if (isActive) {
                dropdownContainer.classList.remove('active');
                searchContainer.classList.add('active');
            } else {
                dropdownContainer.classList.add('active');
                searchContainer.classList.remove('active');
            }
        }

        function handleCategoryChange(index) {
            const categorySelect = document.getElementById(`category${index}`);
            const subcategorySelect = document.getElementById(`subcategory${index}`);
            const productSelect = document.getElementById(`product${index}`);
            const selectedCategory = categorySelect.value;
            subcategorySelect.innerHTML = '<option value="">Selecciona una subcategoría</option>';
            productSelect.innerHTML = '<option value="">Selecciona un producto</option>';
            subcategorySelect.disabled = true;
            productSelect.disabled = true;
            document.getElementById(`quantity${index}`).disabled = true;

            if (selectedCategory) {
                Object.keys(data[selectedCategory]).forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory;
                    option.textContent = subcategory.toUpperCase();
                    subcategorySelect.appendChild(option);
                });
                subcategorySelect.disabled = false;
            }
        }

        function handleSubcategoryChange(index) {
            const selectedCategory = document.getElementById(`category${index}`).value;
            const selectedSubcategory = document.getElementById(`subcategory${index}`).value;
            const productSelect = document.getElementById(`product${index}`);
            const quantityInput = document.getElementById(`quantity${index}`);
            productSelect.innerHTML = '<option value="">Selecciona un producto</option>';
            productSelect.disabled = true;
            quantityInput.disabled = true;

            if (selectedSubcategory) {
                data[selectedCategory][selectedSubcategory].forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    productSelect.appendChild(option);
                });
                productSelect.disabled = false;
            }
        }

        function handleProductChange(index) {
            document.getElementById(`quantity${index}`).disabled = false;
        }

        function searchProduct(index) {
            const query = document.getElementById(`search${index}`).value.toLowerCase();
            const searchResults = document.getElementById(`searchResults${index}`);
            searchResults.innerHTML = "";

            if (query.length > 2) {
                Object.values(data).forEach(subcategories => {
                    Object.values(subcategories).forEach(products => {
                        products.forEach(product => {
                            if (product.name.toLowerCase().includes(query) || product.id.toLowerCase().includes(query)) {
                                const resultItem = document.createElement('div');
                                resultItem.textContent = `${product.id} - ${product.name}`;
                                resultItem.classList.add('search-result-item');
                                resultItem.onclick = () => {
                                    document.getElementById(`quantity${index}`).disabled = false;
                                    document.getElementById(`search${index}`).value = `${product.id} - ${product.name}`;
                                    searchResults.innerHTML = "";
                                };
                                searchResults.appendChild(resultItem);
                            }
                        });
                    });
                });
            }
        }

        addProductRow();
    </script>
</body>

</html>
